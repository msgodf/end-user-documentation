



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Atomist Development Automation Platform">
      
      
      
        <meta name="author" content="The Atomist Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.1, mkdocs-material-2.0.4">
    
    
      
        <title>Commands - The Atomist Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-709eec9410.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-23f75ab9c7.palette.css">
      
    
    
      <script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="blue-grey" data-md-color-accent="blue">
    
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="The Atomist Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../img/atomist-logo-horiz-reversed.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Developer Guide
                </span>
              
            
            Commands
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../img/atomist-logo-horiz-reversed.svg" width="24" height="24">
      
    </span>
    The Atomist Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../user/" title="Using Atomist" class="md-nav__link">
      Using Atomist
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quick-start/" title="Developer Quick Start" class="md-nav__link">
      Developer Quick Start
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Commands
      </label>
    
    <a href="./" title="Commands" class="md-nav__link md-nav__link--active">
      Commands
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#command-handler" title="Command handler" class="md-nav__link">
    Command handler
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handler-arguments" title="Handler arguments" class="md-nav__link">
    Handler arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler-return" title="Handler return" class="md-nav__link">
    Handler return
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-parameters" title="Input Parameters" class="md-nav__link">
    Input Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapped-parameters" title="Mapped Parameters" class="md-nav__link">
    Mapped Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#send-an-http-request" title="Send an HTTP request" class="md-nav__link">
    Send an HTTP request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond" title="Respond" class="md-nav__link">
    Respond
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-a-message-to-a-slack-channel" title="Send a message to a Slack channel" class="md-nav__link">
    Send a message to a Slack channel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-a-direct-message" title="Send a direct message" class="md-nav__link">
    Send a direct message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-a-formatted-message" title="Send a formatted message" class="md-nav__link">
    Send a formatted message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-a-code-change" title="Make a code change" class="md-nav__link">
    Make a code change
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-a-file-to-a-repository" title="Add a file to a repository" class="md-nav__link">
    Add a file to a repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-the-content-of-a-file-in-all-repositories" title="Change the content of a file in all repositories" class="md-nav__link">
    Change the content of a file in all repositories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-code-across-repositories" title="Inspect code across repositories" class="md-nav__link">
    Inspect code across repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-a-new-repository" title="Make a new repository" class="md-nav__link">
    Make a new repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands-in-the-wild" title="Commands in the wild" class="md-nav__link">
    Commands in the wild
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" title="Troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#my-intent-was-not-recognized" title="My intent was not recognized" class="md-nav__link">
    My intent was not recognized
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-was-invoked-unsuccessfully" title="Command was invoked unsuccessfully" class="md-nav__link">
    Command was invoked unsuccessfully
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#something-went-wrong" title="Something went wrong" class="md-nav__link">
    Something went wrong
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../slack/" title="Slack Messages" class="md-nav__link">
      Slack Messages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../graphql/" title="Working with GraphQL" class="md-nav__link">
      Working with GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create/" title="Creating Projects" class="md-nav__link">
      Creating Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../editors/" title="Editing Projects" class="md-nav__link">
      Editing Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../client/" title="Automation Client" class="md-nav__link">
      Automation Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../run/" title="Running Automation Clients" class="md-nav__link">
      Running Automation Clients
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../support/" title="Support" class="md-nav__link">
      Support
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#command-handler" title="Command handler" class="md-nav__link">
    Command handler
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#handler-arguments" title="Handler arguments" class="md-nav__link">
    Handler arguments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handler-return" title="Handler return" class="md-nav__link">
    Handler return
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-parameters" title="Input Parameters" class="md-nav__link">
    Input Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapped-parameters" title="Mapped Parameters" class="md-nav__link">
    Mapped Parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#send-an-http-request" title="Send an HTTP request" class="md-nav__link">
    Send an HTTP request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#respond" title="Respond" class="md-nav__link">
    Respond
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-a-message-to-a-slack-channel" title="Send a message to a Slack channel" class="md-nav__link">
    Send a message to a Slack channel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-a-direct-message" title="Send a direct message" class="md-nav__link">
    Send a direct message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#send-a-formatted-message" title="Send a formatted message" class="md-nav__link">
    Send a formatted message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-a-code-change" title="Make a code change" class="md-nav__link">
    Make a code change
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-a-file-to-a-repository" title="Add a file to a repository" class="md-nav__link">
    Add a file to a repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#change-the-content-of-a-file-in-all-repositories" title="Change the content of a file in all repositories" class="md-nav__link">
    Change the content of a file in all repositories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspect-code-across-repositories" title="Inspect code across repositories" class="md-nav__link">
    Inspect code across repositories
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-a-new-repository" title="Make a new repository" class="md-nav__link">
    Make a new repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commands-in-the-wild" title="Commands in the wild" class="md-nav__link">
    Commands in the wild
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" title="Troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#my-intent-was-not-recognized" title="My intent was not recognized" class="md-nav__link">
    My intent was not recognized
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-was-invoked-unsuccessfully" title="Command was invoked unsuccessfully" class="md-nav__link">
    Command was invoked unsuccessfully
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#something-went-wrong" title="Something went wrong" class="md-nav__link">
    Something went wrong
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Commands</h1>
                
                <p>Trigger your automations from the web or Slack!  Commands respond to
requests &ndash; like <code>@atomist do my thing</code> or a button press.  You can
create your own commands to make the Atomist bot do what you want.</p>
<p>For the fastest path to a command handler,
follow <a href="https://the-composition.com/extending-your-slack-bot-part-1-commands-aaa4dbd47933">this quick-start blog post</a>.</p>
<p>If you already have an automation client,
this page will help you add a command handler to it.</p>
<p>You&rsquo;ll need</p>
<ul>
<li>An <a href="../client/">automation client</a> of your own</li>
<li>A task you want to automate, even if it&rsquo;s just saying &ldquo;Hello, World!&rdquo;</li>
<li>A phrase that people can say in Slack to trigger it, i.e., the commands <em>intent</em></li>
<li>A name for the command handler</li>
</ul>
<p>In this guide you&rsquo;ll create MyCommandHandler, which responds to &ldquo;do my thing&rdquo;.</p>
<h2 id="command-handler">Command handler<a class="headerlink" href="#command-handler" title="Permanent link">&para;</a></h2>
<p>Command handlers are classes with a <code>handle</code> method and some
decorators that supply metadata.  Store them anywhere in the <code>src</code>
directory; your automation client discovers them on startup
(or <a href="../client/#client-configuration">specify them yourself</a>).</p>
<p>You can add a class to any file,
or make a new TypeScript file anywhere in the <code>src</code> directory,
like <code>src/commands/MyCommandHandler.ts</code>.</p>
<p>Start by copying the content of
<a href="https://github.com/atomist/automation-client-samples-ts/blob/master/src/commands/simple/HelloWorld.ts">the HelloWorld sample</a>
into a new file to start with.</p>
<p>A command handler class implements <code>HandleCommand</code>, with a <code>handle</code>
method, and is decorated with <code>@CommandHandler</code>.  It can also
contain <a href="#parameters">parameter specifications</a> to gather additional
information.</p>
<p>The <code>@CommandHandler(description: string, intent: string)</code> decorator
on the class adds the top-level metadata that Atomist needs to run
your command handler.  The <code>intent</code> parameter is important: it&rsquo;s the
phrase people type in Slack to trigger this handler. Your
<code>description</code> will show up in help messages.</p>
<p>Implement your automation in the <code>handle</code> method.</p>
<p>The simplest command handler:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span>
    <span class="nx">CommandHandler</span><span class="p">,</span>
    <span class="nx">HandleCommand</span><span class="p">,</span>
    <span class="nx">HandlerContext</span><span class="p">,</span>
    <span class="nx">HandlerResult</span><span class="p">,</span>
    <span class="nx">Success</span><span class="p">,</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client&quot;</span><span class="p">;</span>

<span class="kd">@CommandHandler</span><span class="p">(</span><span class="s2">&quot;My sample command handler&quot;</span><span class="p">,</span> <span class="s2">&quot;do my thing&quot;</span><span class="p">)</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">MyCommandHandler</span> <span class="kr">implements</span> <span class="nx">HandleCommand</span> <span class="p">{</span>

    <span class="kr">public</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">context</span>: <span class="kt">HandlerContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">HandlerResult</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">Success</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3 id="handler-arguments">Handler arguments<a class="headerlink" href="#handler-arguments" title="Permanent link">&para;</a></h3>
<p>The <code>handle</code> method receives a <a href="https://atomist.github.io/automation-client-ts/interfaces/_handlercontext_.handlercontext.html" title="Reference Documentation - Handler Context"><code>HandlerContext</code></a>. It
contains the following useful members:</p>
<ul>
<li><code>messageClient: MessageClient</code> lets you send Slack messages from
    the Atomist bot.  You can send messages to
    particular <a href="../slack/#user-and-channel-messages">users</a>,
    particular <a href="../slack/#user-and-channel-messages">channels</a>, or
    to <a href="../slack/#response-messages">whoever typed the command</a>.</li>
<li><code>graphClient: GraphClient</code> lets you run queries against the
    Atomist <a href="../graphql/">GraphQL API</a>, where you can discover things
    like which builds failed on which commits, who made those commits,
    and what their Slack username is.</li>
</ul>
<p>When you need more information, define <a href="#parameters">parameters</a>
in your command handler.</p>
<h3 id="handler-return">Handler return<a class="headerlink" href="#handler-return" title="Permanent link">&para;</a></h3>
<p>A <code>HandlerResult</code> is an object containing a return code (0 for
success, anything else for error).  You can add other properties to
the object for debugging; they&rsquo;ll show up in your automation client&rsquo;s
log.  Return this <code>HandlerResult</code> after doing whatever it is you&rsquo;d
like your automation to accomplish.</p>
<p>The do-nothing <code>handle</code> method creates a Promise from a successful
<code>HandlerResult</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span> <span class="nx">code</span>: <span class="kt">0</span> <span class="p">})</span>
</pre></div>

<p>There&rsquo;s a <code>Success</code> object in <code>@atomist/automation-client/HandlerResult</code>
that you can substitute for <code>{ code: 0 }</code> to be extra expressive, or a
<code>success</code> function for when you need <code>() =&gt; { code: 0 }</code> like when
translating a Promise of something else into a <code>HandlerResult</code>: <code>promise.then(success)</code>.</p>
<p>The <code>handle</code> method returns a Promise because usually you&rsquo;ll want to do something
fun asynchronously, like respond in Slack.
The <code>messageClient.respond</code> method returns a Promise,
so you can return success after the message is sent:</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">messageClient</span><span class="p">.</span><span class="nx">respond</span><span class="p">(</span><span class="s2">&quot;That sounds like a great idea!&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">success</span><span class="p">)</span>
</pre></div>

<!--
## Command examples

Some quick examples for common automations:

-   [Send an HTTP request](command-examples.md#send-an-http-request)
-   [Send a message to a particular channel](command-examples.md#send-a-message-to-a-particular-channel)
-   [Add a file to one repository](command-examples.md#add-a-file-to-a-single-repository) in a pull request
-   [Change the content of many repositories](command-examples.md#change-the-content-of-a-file-in-all-repositories)
 in many pull requests
-   [Inspect code in all repositories](command-examples.md#inspect-code-across-repositories) and report on it in Slack
-   [Send a direct message](command-examples.md#send-a-direct-message)
-   [Send a fancy formatted message](command-examples.md#send-a-message-thats-more-than-text)
-->

<h2 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h2>
<p>You don&rsquo;t want your command handler to do the <em>same</em> thing every
time. Gather more information from parameters!  By annotating your
command handler fields with <code>@Parameter</code>, <code>@MappedParameter</code>, or
<code>@Secret</code>, you are instructing Atomist automation API to collect and
provide values for those parameters when your command is invoked.</p>
<p>You can get this information from the user or button definition
(<code>@Parameter</code>) or from Atomist&rsquo;s understanding of where the command
was invoked (<code>@MappedParameter</code>).</p>
<h3 id="input-parameters">Input Parameters<a class="headerlink" href="#input-parameters" title="Permanent link">&para;</a></h3>
<p>These may be simple values that need to be supplied to run your
command handler. For example, the issue number to close or the build
number to restart. When a user invokes your command in Slack, the
Atomist bot will prompt her in a thread to supply value for each
required parameter. The user will get to review the provided parameter
values, change them if desired, and click or type Submit.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can supply parameters in one line with <code>name=value</code> pairs like: <code>@atomist do my thing buildId=42</code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If there are no required parameters, your command will be invoked right away.</p>
</div>
<p>In Slack buttons, the automation creating
the <a href="../slack/#adding-message-buttons">button</a> can supply as many
parameters as it knows. Whoever clicks the button will be prompted for
any other required parameters.</p>
<p>When you decorate a field with <code>@Parameter</code>,
you can pass the decorator an object describing the parameter.
Here are some examples:</p>
<p>A <code>buildId</code> is required, and it is a <code>string</code> of digits:</p>
<div class="codehilite"><pre><span></span><span class="kd">@Parameter</span><span class="p">({</span> <span class="nx">pattern</span><span class="o">:</span> <span class="sr">/^[0-9]+$/</span> <span class="p">})</span>
<span class="kr">public</span> <span class="nx">buildId</span>: <span class="kt">string</span><span class="p">;</span>
</pre></div>

<p>An animal can be specified, or it&rsquo;ll default to armadillo:</p>
<div class="codehilite"><pre><span></span><span class="kd">@Parameter</span><span class="p">({})</span>
<span class="kr">public</span> <span class="nx">animal</span>: <span class="kt">string</span> <span class="o">=</span> <span class="s2">&quot;armadillo&quot;</span><span class="p">;</span>
</pre></div>

<p>You can define:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>pattern</td>
<td>If you want to validate values, pass a <code>RegExp</code>. It must start with <code>^</code> and end with <code>$</code> so that it covers the whole value. Default: <code>/^[\S\s]*$/</code> for &ldquo;anything&rdquo;</td>
</tr>
<tr>
<td>required</td>
<td>set this to <code>false</code> if the parameter is optional. If you supply a default value for the field, we&rsquo;ll automatically set required to <code>false</code>!</td>
</tr>
<tr>
<td>description</td>
<td>the Slack or Atomist dashboard user will see this when they&rsquo;re prompted for the parameter.</td>
</tr>
<tr>
<td>displayName</td>
<td>defaults to the name of the field you&rsquo;re decorating</td>
</tr>
<tr>
<td>validInput</td>
<td>if you supplied a pattern, you may also want to describe in words what input is valid.</td>
</tr>
<tr>
<td>displayable</td>
<td>If <code>false</code>, hide this parameter from the user before when prompting them to submit. For instance, sometimes buttons include cryptic internal identifiers.</td>
</tr>
<tr>
<td>maxLength</td>
<td>if you want to limit the length of a parameter, supply a number here.</td>
</tr>
<tr>
<td>minLength</td>
<td>if you want at least so many characters, supply a number here.</td>
</tr>
<tr>
<td>type</td>
<td><code>string</code> or <code>boolean</code> or <code>number</code>, although we&rsquo;ll figure that out from the type of the field if we can.</td>
</tr>
</tbody>
</table>
<h3 id="mapped-parameters">Mapped Parameters<a class="headerlink" href="#mapped-parameters" title="Permanent link">&para;</a></h3>
<p>There are a few things Atomist can infer from who invoked this command, or what channel they invoked it in.
You can request this information by decorating fields with <code>@MappedParameter</code>.
Supply one argument to that decorator to tell it which of the MappedParameters you want.</p>
<div class="codehilite"><pre><span></span><span class="kd">@MappedParameter</span><span class="p">(</span><span class="nx">MappedParameters</span><span class="p">.</span><span class="nx">SlackUserName</span><span class="p">)</span>
<span class="kr">public</span> <span class="nx">slackUserName</span>: <span class="kt">string</span><span class="p">;</span>
</pre></div>

<p>In Slack, if the value is ambiguous based on your team and channel, Atomist asks the user.</p>
<p>In Slack buttons, the automation that defines the button can provide values for these.</p>
<p>The available Mapped Parameters are:</p>
<table>
<thead>
<tr>
<th>Constant</th>
<th>What you get</th>
</tr>
</thead>
<tbody>
<tr>
<td>MappedParameters.SlackUserName</td>
<td>Who invoked this command? This is the username, not the display name of the user. For instance: jessitron</td>
</tr>
<tr>
<td>MappedParameters.SlackUser</td>
<td>The ID of the Slack user who invoked the command. For instance: U6L3BGG01;</td>
</tr>
<tr>
<td>MappedParameters.SlackChannelName</td>
<td>The name of the channel where the command was invoked.</td>
</tr>
<tr>
<td>MappedParameters.SlackChannel</td>
<td>The ID of the channel where the command was invoked. For instance: C3NGYQF6Y</td>
</tr>
<tr>
<td>MappedParameters.SlackTeam</td>
<td>The ID of your Slack team. For instance: T6MFSPUDL</td>
</tr>
<tr>
<td>MappedParameters.GitHubRepository</td>
<td>If the command was invoked in a <a href="../../user/#linking-slack-github" title="Link GitHub Repository to Slack Channel">channel linked to exactly one repository</a>, this is the name of it. Otherwise, prompt for one of the repository names in your team.</td>
</tr>
<tr>
<td>MappedParameters.GitHubOwner</td>
<td>If your team has one <a href="../../user/#organization-webhooks" title="Link GitHub Organization to Atomist">linked organization</a>, this is it. If the command was invoked in a <a href="../../user/#linking-slack-github" title="Link GitHub Repository to Slack Channel">channel linked to exactly one repository</a>, this is the owner of that repository. Otherwise, prompt for one of the organizations linked to your team.</td>
</tr>
<tr>
<td>MappedParameters.GitHubUrl</td>
<td>This is <a href="https://github.com">https://github.com</a> unless you&rsquo;re on GitHub Enterprise.</td>
</tr>
<tr>
<td>MappedParameters.GitHubApiUrl</td>
<td>This is <a href="https://api.github.com">https://api.github.com</a> unless you&rsquo;re on GitHub Enterprise.</td>
</tr>
<tr>
<td>MappedParameters.GitHubDefaultRepositoryVisibility</td>
<td>our best guess for whether you prefer to create new repositories as &ldquo;public&rdquo; or &ldquo;private&rdquo;.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mapped Parameters are available in Command Handlers but <em>not</em> Event Handlers.</p>
</div>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>Here are some examples of simple <a href="./">commands</a>.</p>
<h3 id="send-an-http-request">Send an HTTP request<a class="headerlink" href="#send-an-http-request" title="Permanent link">&para;</a></h3>
<p>Call endpoints on the internet or in your internal network, anywhere accessible where your own automation client is running.</p>
<p>Check out a
<a href="https://github.com/atomist/automation-client-samples-ts/blob/master/src/commands/simple/HelloHttp.ts">very simple HTTP example</a>,
 or a more complicated one that
 <a href="https://github.com/atomist-blogs/sof-command/blob/master/src/commands/SearchStackOverflow.ts">Searches Stack Overflow</a>.</p>
<h3 id="respond">Respond<a class="headerlink" href="#respond" title="Permanent link">&para;</a></h3>
<p>This <code>respond</code> message posts to Slack in the same
channel where the command was invoked.</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">messageClient</span><span class="p">.</span><span class="nx">respond</span><span class="p">(</span><span class="s2">&quot;I hear you.&quot;</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">success</span><span class="p">);</span>
</pre></div>

<h3 id="send-a-message-to-a-slack-channel">Send a message to a Slack channel<a class="headerlink" href="#send-a-message-to-a-slack-channel" title="Permanent link">&para;</a></h3>
<p>Send a message to the channel you specify.
<a href="https://github.com/atomist/automation-client-samples-ts/blob/master/src/commands/simple/HelloChannel.ts">Here&rsquo;s a simple handler</a>.</p>
<p>I use to send messages from automations under development to a particular Slack channel
that serves as an informal audit log.</p>
<h3 id="send-a-direct-message">Send a direct message<a class="headerlink" href="#send-a-direct-message" title="Permanent link">&para;</a></h3>
<p>Perhaps you&rsquo;d like to DM yourself whenever someone runs your automation.
The <code>addressUsers</code> method on the messageClient has a second argument: a Slack username or an array of Slack usernames.</p>
<div class="codehilite"><pre><span></span><span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">messageClient</span><span class="p">.</span><span class="nx">addressUsers</span><span class="p">(</span><span class="s2">&quot;ping&quot;</span><span class="p">,</span><span class="s2">&quot;jessitron&quot;</span><span class="p">)</span>
           <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">success</span><span class="p">)</span>
</pre></div>

<h3 id="send-a-formatted-message">Send a formatted message<a class="headerlink" href="#send-a-formatted-message" title="Permanent link">&para;</a></h3>
<p>All of the messageClient methods (<code>respond</code>, <code>addressChannels</code>,
<code>addressUsers</code>) accept either a string or Slack message object.  Learn
about formatting options
on <a href="https://api.slack.com/docs/messages/builder?msg=%7B%22text%22%3A%22These%20are%20a%20few%20of%20my%20favorite%20things%3A%22%2C%22attachments%22%3A%5B%7B%22fallback%22%3A%22my%20favorite%20vegetable%20is%20carrots%22%2C%22title%22%3A%22Vegetable%22%2C%22color%22%3A%22%23ffa500%22%2C%22text%22%3A%22carrots%22%7D%2C%7B%22fallback%22%3A%22my%20favorite%20coffee%22%2C%22title%22%3A%22Coffee%20Drink%22%2C%22title_link%22%3A%22https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FCappuccino%22%2C%22color%22%3A%226f4e37%22%2C%22text%22%3A%22cappuccino%20%3Acoffee%3A%22%7D%5D%7D" title="Slack API Message Builder">Slack&rsquo;s message builder page</a>.</p>
<p>Find full information about all the options
under <a href="../slack/">Slack Messages</a>, including how to add buttons.</p>
<!-- TODO: describe a command that queries the graph. -->

<h3 id="make-a-code-change">Make a code change<a class="headerlink" href="#make-a-code-change" title="Permanent link">&para;</a></h3>
<p>Atomist lets developers automate their work, and that includes
changing code.  The <code>@atomist/automation-client</code> module that you can
find in your automation client has tools for creating and editing
projects.</p>
<p>For instance, you might want to:</p>
<h4 id="add-a-file-to-a-repository">Add a file to a repository<a class="headerlink" href="#add-a-file-to-a-repository" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/atomist/automation-client-samples-ts/blob/master/src/commands/editor/AddContributing.ts" title="Command - Add File">This example</a> adds a <code>CONTRIBUTING.md</code> file to one
repository, with organization-standard content.</p>
<p>Learn more in <a href="../editors/">editors</a>.</p>
<h4 id="change-the-content-of-a-file-in-all-repositories">Change the content of a file in all repositories<a class="headerlink" href="#change-the-content-of-a-file-in-all-repositories" title="Permanent link">&para;</a></h4>
<p>Why stop at just one repository? This is automation! You can change them all!</p>
<p>A command can <a href="https://github.com/atomist/automation-client-samples-ts/tree/master/src/commands/editor/UpdateCopyright.ts">update the copyright year in all the READMEs in all your repositories</a>.</p>
<p>With this handler running
in your automation client, you can initiate PRs on all out-of-date repositories with a single invocation of
 <code>@atomist update README copyright year</code> in Slack.</p>
<p>Learn more in <a href="../editors/">editors</a>.</p>
<h3 id="inspect-code-across-repositories">Inspect code across repositories<a class="headerlink" href="#inspect-code-across-repositories" title="Permanent link">&para;</a></h3>
<p>Checks which repositories are up to current coding standards.</p>
<p><a href="https://github.com/atomist/automation-client-samples-ts/tree/master/src/commands/reviewer/ReviewCopyright.ts">This example</a>
checks which repositories have a current copyright notice in the README. It then reports on every repository: Does it have a copyright notice? If so, is it up-to-date?</p>
<h3 id="make-a-new-repository">Make a new repository<a class="headerlink" href="#make-a-new-repository" title="Permanent link">&para;</a></h3>
<p>When you want to make a new service or library, it&rsquo;s common to start by copying an old one. With Atomist,
you can automate the copy, and modify the starting point to be your new service.</p>
<p>Check out this
<a href="https://github.com/atomist/automation-client-samples-ts/blob/master/src/commands/generator/NewAutomation.ts">example</a>
that copies a sample automation client into your own repository.</p>
<p>Once the repository is created, you can do things like add collaborators, teams, or labels to bring the
GitHub repository to your standards. For examples, the Atomist
<a href="https://github.com/atomist/initializr-atomist/blob/1b90f78f31ec157489f6e6d53a0ccb7372e0e53d/src/commands/generator/initializr/SpringRepoCreator.ts#L56">Spring generator</a>
adds a collaborator
(and accepts the invitation) as part of project creation.</p>
<h3 id="commands-in-the-wild">Commands in the wild<a class="headerlink" href="#commands-in-the-wild" title="Permanent link">&para;</a></h3>
<p>There&rsquo;s a <a href="https://github.com/atomist/automation-client-samples-ts" title="Atomist Automation Client Sample Automations">repository full of sample automations</a> with
example commands, including editors and generators.</p>
<p>The built-in GitHub and build notifications, along with commands like
<code>create issue</code>, live in <a href="https://github.com/atomist/lifecycle-automation" title="Atomist's Built-In Lifecycle Automations">lifecycle-automation</a>.</p>
<p>One handy command for automation developers runs tslint in a Docker
container for every push to a TypeScript repository.  You&rsquo;ll find it
in the <a href="https://github.com/atomist/automation-client-samples-ts-docker" title="Atomist Docker Automation Client Samples">docker samples</a>.</p>
<p><a href="https://join.atomist.com">Tell us</a> about yours!</p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>You can test command handlers the same way you test any TypeScript
class.
<a href="https://github.com/atomist/automation-client-ts/blob/master/docs/CommandTesting.md">A client doc</a> describes the Atomist team&rsquo;s testing style for commands, but there are many ways to test.
If you already have a favorite TypeScript or JavaScript testing style and framework, use that.</p>
<p>You can also test command handlers by hand: run the client locally and
then address Atomist in a Slack DM or a channel.</p>
<!--
You can [test command handlers automatically](command-examples.md#automated-tests-for-command-handlers) as well.
-->

<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<p>Anything you print with console.log() in your command handler will show up in the logs of your automation-client.
If you&rsquo;re running locally, these logs go to stdout.</p>
<h3 id="my-intent-was-not-recognized">My intent was not recognized<a class="headerlink" href="#my-intent-was-not-recognized" title="Permanent link">&para;</a></h3>
<p>When you tell Atomist to do the thing, and it responds with</p>
<p><code>Hmm, I don't understand 'do my thing'. How about: ...</code></p>
<p>It&rsquo;ll guess at nearby commands. This means it didn&rsquo;t find your intent.</p>
<p>To see everything available, try <code>@atomist show skills</code>.
This lists commands registered by automation client.
 Is your automation client listed?
If not, perhaps it is not running.</p>
<p>If you can&rsquo;t tell, consider changing the name of your automation client
(in package.json) to something you&rsquo;ll recognize.</p>
<p>If your automation client is listed but your automation is not,
perhaps it is not included in <a href="../client/#client-configuration"><code>atomist.config.ts</code></a>.</p>
<h3 id="command-was-invoked-unsuccessfully">Command was invoked unsuccessfully<a class="headerlink" href="#command-was-invoked-unsuccessfully" title="Permanent link">&para;</a></h3>
<p>When your handler returns a failure status, you&rsquo;ll see a message in Slack:</p>
<div class="codehilite"><pre><span></span>Unable to run command
Unsuccessfully invoked command-handler MyCommandHandler of my-automation@0.1.0
</pre></div>

<p>Check the logs of your automation client to figure out what went wrong.</p>
<!-- Add this in when I explain parameter objects
### No parameters were received

Check your log at startup for the registration message. Does it list the parameters for your command?
If not, are you using a separate class for parameters? check that you provided a factory method for it in your handler.
Also check that fields are annotated with @Parameter or @MappedParameter. 
-->

<h3 id="something-went-wrong">Something went wrong<a class="headerlink" href="#something-went-wrong" title="Permanent link">&para;</a></h3>
<p>If the bot tells you &ldquo;Oops, something went wrong&rdquo;&hellip;  that&rsquo;s our
bad.  Please contact us through any of our <a href="../../support/">support channels</a>.
We want to help!</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../prerequisites/" title="Prerequisites" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Prerequisites
              </span>
            </div>
          </a>
        
        
          <a href="../events/" title="Events" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Events
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2017 Atomist, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://the-composition.com/" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://github.com/atomist" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/atomist" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://join.atomist.com/" class="md-footer-social__link fa fa-slack"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-8e4952e681.js"></script>
      
      <script>app.initialize({version:"0.17.1",url:{base:"../.."}})</script>
      
        <script src="../../js/intercom.js"></script>
      
        <script src="../../js/mixpanel.js"></script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-74966852-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>