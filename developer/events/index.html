



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Atomist Development Automation Platform">
      
      
      
        <meta name="author" content="The Atomist Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.1, mkdocs-material-2.0.4">
    
    
      
        <title>Events - The Atomist Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-709eec9410.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-23f75ab9c7.palette.css">
      
    
    
      <script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="blue-grey" data-md-color-accent="blue">
    
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="The Atomist Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../img/atomist-logo-horiz-reversed.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Developer Guide
                </span>
              
            
            Events
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../img/atomist-logo-horiz-reversed.svg" width="24" height="24">
      
    </span>
    The Atomist Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../user/" title="Using Atomist" class="md-nav__link">
      Using Atomist
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quick-start/" title="Developer Quick Start" class="md-nav__link">
      Developer Quick Start
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../commands/" title="Commands" class="md-nav__link">
      Commands
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Events
      </label>
    
    <a href="./" title="Events" class="md-nav__link md-nav__link--active">
      Events
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#event-handler-structure" title="Event handler structure" class="md-nav__link">
    Event handler structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unit-test" title="Unit test" class="md-nav__link">
    Unit test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#respond-to-new-commits" title="Respond to new commits" class="md-nav__link">
    Respond to new commits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comment-on-an-issue" title="Comment on an issue" class="md-nav__link">
    Comment on an issue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#react-to-a-failed-build" title="React to a failed build" class="md-nav__link">
    React to a failed build
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" title="Troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#my-event-didnt-arrive" title="My event didn't arrive" class="md-nav__link">
    My event didn't arrive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#my-handler-didnt-do-what-i-expected" title="My handler didn't do what I expected" class="md-nav__link">
    My handler didn't do what I expected
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../slack/" title="Slack Messages" class="md-nav__link">
      Slack Messages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../graphql/" title="Working with GraphQL" class="md-nav__link">
      Working with GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create/" title="Creating Projects" class="md-nav__link">
      Creating Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../editors/" title="Editing Projects" class="md-nav__link">
      Editing Projects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../client/" title="Automation Client" class="md-nav__link">
      Automation Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../run/" title="Running Automation Clients" class="md-nav__link">
      Running Automation Clients
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../support/" title="Support" class="md-nav__link">
      Support
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#event-handler-structure" title="Event handler structure" class="md-nav__link">
    Event handler structure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unit-test" title="Unit test" class="md-nav__link">
    Unit test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" title="Examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#respond-to-new-commits" title="Respond to new commits" class="md-nav__link">
    Respond to new commits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comment-on-an-issue" title="Comment on an issue" class="md-nav__link">
    Comment on an issue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#react-to-a-failed-build" title="React to a failed build" class="md-nav__link">
    React to a failed build
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" title="Troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#my-event-didnt-arrive" title="My event didn't arrive" class="md-nav__link">
    My event didn't arrive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#my-handler-didnt-do-what-i-expected" title="My handler didn't do what I expected" class="md-nav__link">
    My handler didn't do what I expected
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Events</h1>
                
                <p>Event handlers are automations that trigger when events happen, such
as pull requests, updated issues, failed builds and more.  You can
create your own event handlers to make Atomist react however you want.</p>
<p>To create an event handler, you
need <a href="../client/" title="Atomist Automation Client">an automation client of your own</a> and an event you want
to react to.  The sample event handler below notifies you in Slack when
a new GitHub issue is created.</p>
<p>When writing an event handler, you need to understand the events
involved. You
can
<a href="../graphql/#accessing-data-with-graphiql" title="Accessing Data with GraphiQL">use GraphiQL to query for events</a>
their properties, and their relationships.  For example, this query
shows the issue number and title for all your issues.</p>
<div class="codehilite"><pre><span></span>{
  Issue {
    number
    title
  }
}
</pre></div>

<p>Events can have relationships when it makes sense, even between
different systems. Issues are related to their repo, and GitHub repos
may also be associated with Slack channels. You can get all the
information about these relationships in one query.</p>
<div class="codehilite"><pre><span></span>{
  Issue {
    number
    title
    repo {
      owner
      name
      channels {
        name
      }
    }
  }
}
</pre></div>

<p>This query actually returns more data than is needed. In this case you
only want the open issues. You can use a GraphQL argument to get
exactly that, without making additional queries, and without having to
filter the results later in code.</p>
<div class="codehilite"><pre><span></span>{
  Issue(state: open) {
    number
    title
    repo {
      owner
      name
      channels {
        name
      }
    }
  }
}
</pre></div>

<p>There are a lot of interesting events and convenient relationships
between them.  Exploring your builds, releases, Slack channels,
comments and more using GraphQL may give you additional ideas for
event handlers to build.  For now, let&rsquo;s use this query to write our
event handler.</p>
<h2 id="event-handler-structure">Event handler structure<a class="headerlink" href="#event-handler-structure" title="Permanent link">&para;</a></h2>
<p>Here is a complete event handler that listens for new issues and
notifies you.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">EventHandler</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/decorators&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">EventFired</span><span class="p">,</span> <span class="nx">HandleEvent</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/HandleEvent&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HandlerContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/HandlerContext&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span>
    <span class="nx">failure</span><span class="p">,</span>
    <span class="nx">HandlerResult</span><span class="p">,</span>
    <span class="nx">success</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/HandlerResult&quot;</span><span class="p">;</span>

<span class="kd">@EventHandler</span><span class="p">(</span><span class="s2">&quot;Notify channel on new issue&quot;</span><span class="p">,</span>
    <span class="sb">`subscription IssueNotification</span>
<span class="sb">{</span>
<span class="sb">  Issue(state: open) {</span>
<span class="sb">    number</span>
<span class="sb">    title</span>
<span class="sb">    repo {</span>
<span class="sb">      owner</span>
<span class="sb">      name</span>
<span class="sb">      channels {</span>
<span class="sb">        name</span>
<span class="sb">      }</span>
<span class="sb">    }</span>
<span class="sb">  }</span>
<span class="sb">}`</span><span class="p">)</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">IssueNotification</span> <span class="kr">implements</span> <span class="nx">HandleEvent</span><span class="o">&lt;</span><span class="nx">Issues</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kr">public</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">e</span>: <span class="kt">EventFired</span><span class="o">&lt;</span><span class="nx">Issues</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">ctx</span>: <span class="kt">HandlerContext</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">HandlerResult</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">Issue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">messageClient</span><span class="p">.</span><span class="nx">addressChannels</span><span class="p">(</span>
            <span class="sb">`New issue: #</span><span class="si">${</span><span class="nx">issue</span><span class="p">.</span><span class="kt">number</span><span class="si">}</span><span class="sb"> &#39;</span><span class="si">${</span><span class="nx">issue</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">&#39; in </span><span class="si">${</span><span class="nx">issue</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">owner</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nx">issue</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
            <span class="nx">issue</span><span class="p">.</span><span class="nx">repo</span><span class="p">.</span><span class="nx">channels</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
        <span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span> <span class="nx">failure</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="kr">interface</span> <span class="nx">Issues</span> <span class="p">{</span>
    <span class="nx">Issue</span><span class="o">:</span> <span class="p">[{</span>
        <span class="kt">number</span><span class="o">:</span> <span class="kt">number</span><span class="p">;</span>
        <span class="nx">title</span>: <span class="kt">string</span><span class="p">;</span>
        <span class="nx">repo</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">owner</span>: <span class="kt">string</span><span class="p">;</span>
            <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
            <span class="nx">channels</span><span class="o">:</span> <span class="p">[{</span>
                <span class="nx">name</span>: <span class="kt">string</span><span class="p">;</span>
            <span class="p">}]</span>
        <span class="p">}</span>
    <span class="p">}]</span>
<span class="p">}</span>
</pre></div>

<p>The <code>@EventHandler</code> decorator allows you to provide a description and
a query to subscribe to. Notice the GraphQL that you built up in the
previous section.  You
can <a href="../graphql/#subscriptions" title="GraphQL Subscriptions">define the subscription GraphQL query</a> inline
or reference a file. It also implements <code>HandleEvent</code> which specifies
the handle method.  This is where your automation code goes. Every
matching event triggers the code here.  From here you have access to
the event itself with <code>EventFired</code> and
a <a href="../commands/#handler-arguments" title="Handler Arguments"><code>HandlerContext</code></a> for interacting with Slack or
querying more events.  While a command handler has <code>@Parameters</code> and
<code>@MappedParamters</code> to specify the details on invocation, an event
handler does not.  Instead it acts on the data inside the event.</p>
<p>This example uses the <code>HandlerContext</code> to send a message about the new
issue to any associated channels it has.  Most of the work is done
just by the subscription query that provides the data the event
handler needs.  The <code>Issues</code> interface exists merely for the
convenience of having a typed <code>EventFired</code>, but there are ways to
<a href="../graphql/#strongly-typed-graphql-queries">generate this type implicitly from the GraphQL schema</a>.  This event
handler returns a <a href="../commands/#handler-return" title="Handler Return"><code>HandlerResult</code></a> based
on the success of the operation.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>You are not limited to notifications in the handle method; you can
do whatever you want with your event data!</p>
</div>
<h2 id="unit-test">Unit test<a class="headerlink" href="#unit-test" title="Permanent link">&para;</a></h2>
<p>Event handlers run in the background based on incoming events, so it&rsquo;s
crucial to test so you can be sure that they do what you expect in
various cases.  Event handlers are very unit testable by design.</p>
<p>Here is a test for the issue notification event handler:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">EventFired</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/HandleEvent&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">HandlerContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/HandlerContext&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">guid</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/internal/util/string&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">MessageOptions</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/spi/message/MessageClient&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">MessageClientSupport</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/spi/message/MessageClientSupport&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">SlackMessage</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/slack-messages/SlackMessages&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="s2">&quot;mocha&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="nx">assert</span> <span class="nx">from</span> <span class="s2">&quot;power-assert&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">IssueNotification</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;../../../../src/tutorial/lessons/events/IssueNotification&quot;</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;IssueNotification&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="kr">const</span> <span class="nx">payloadNewIssue</span> <span class="o">=</span> <span class="sb">`{</span>
<span class="sb">    &quot;data&quot;: {</span>
<span class="sb">        &quot;Issue&quot;: [{</span>
<span class="sb">            &quot;number&quot;: 123,</span>
<span class="sb">            &quot;title&quot;: &quot;another bug to fix&quot;,</span>
<span class="sb">            &quot;repo&quot;: {</span>
<span class="sb">                &quot;owner&quot;: &quot;negan&quot;,</span>
<span class="sb">                &quot;name&quot;: &quot;saviors&quot;,</span>
<span class="sb">                &quot;channels&quot;: [</span>
<span class="sb">                    {</span>
<span class="sb">                        &quot;name&quot;: &quot;water-cooler-talk&quot;</span>
<span class="sb">                    }</span>
<span class="sb">                ]</span>
<span class="sb">            }</span>
<span class="sb">        }]</span>
<span class="sb">    }</span>
<span class="sb">}`</span><span class="p">;</span>

    <span class="kr">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IssueNotification</span><span class="p">();</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;notifies channel&quot;</span><span class="p">,</span> <span class="nx">done</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kr">class</span> <span class="nx">FakeMessageClient</span> <span class="kr">extends</span> <span class="nx">MessageClientSupport</span> <span class="p">{</span>
            <span class="kr">protected</span> <span class="nx">doSend</span><span class="p">(</span><span class="nx">msg</span>: <span class="kt">string</span> <span class="o">|</span> <span class="nx">SlackMessage</span><span class="p">,</span> <span class="nx">userNames</span>: <span class="kt">string</span> <span class="o">|</span> <span class="kt">string</span><span class="p">[],</span>
                             <span class="nx">channelNames</span>: <span class="kt">string</span> <span class="o">|</span> <span class="kt">string</span><span class="p">[],</span> <span class="nx">options?</span>: <span class="kt">MessageOptions</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span> <span class="p">{</span>
                <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="s2">&quot;New issue: #123 &#39;another bug to fix&#39; in negan.saviors&quot;</span><span class="p">);</span>
                <span class="nx">assert</span><span class="p">.</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">channelNames</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;water-cooler-talk&quot;</span><span class="p">]);</span>
                <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="kr">const</span> <span class="nx">ctx</span>: <span class="kt">HandlerContext</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">teamId</span><span class="o">:</span> <span class="s2">&quot;teamId1&quot;</span><span class="p">,</span>
            <span class="nx">correlationId</span><span class="o">:</span> <span class="s2">&quot;correlationId1&quot;</span><span class="p">,</span>
            <span class="nx">invocationId</span>: <span class="kt">guid</span><span class="p">(),</span>
            <span class="nx">graphClient</span>: <span class="kt">undefined</span><span class="p">,</span>
            <span class="nx">messageClient</span>: <span class="kt">new</span> <span class="nx">FakeMessageClient</span><span class="p">(),</span>
        <span class="p">};</span>
        <span class="nx">handler</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">payloadNewIssue</span><span class="p">)</span> <span class="kr">as</span> <span class="nx">EventFired</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">done</span><span class="p">,</span> <span class="nx">done</span><span class="p">);</span>
    <span class="p">});</span>

<span class="p">});</span>
</pre></div>

<p>To test your event handler, simply call the <code>handle</code> method with an
event payload like it might see in the wild.  Notice that instead of
actually sending a message, the sample provides a <code>FakeMessageClient</code>
(via the <code>HandlerContext</code>) where you assert about the way the message
would be sent.  A real test should exercise other test cases that are
not necessarily the happy path.</p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<h3 id="respond-to-new-commits">Respond to new commits<a class="headerlink" href="#respond-to-new-commits" title="Permanent link">&para;</a></h3>
<p>When commits are pushed to GitHub, a Push event is triggered.</p>
<p>For instance, Atomist can run a linter with autofix, and commit the result back to the branch! We run
<a href="https://github.com/atomist/automation-client-samples-ts-docker/blob/master/src/handlers/PushToTsLinting.ts">this handler</a>
in our teams.</p>
<p>This
<a href="https://github.com/atomist/automation-client-samples-ts/blob/master/src/events/NotifyOnPush.ts">simple handler</a>
sends a message in Slack about a push.</p>
<h3 id="comment-on-an-issue">Comment on an issue<a class="headerlink" href="#comment-on-an-issue" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/atomist/automation-client-samples-ts/blob/master/src/events/CommentOnIssue.ts">This handler</a>
also watches for new or updated GitHub issues. It makes a comment on issues created by you, the runner of the automation
client.</p>
<h3 id="react-to-a-failed-build">React to a failed build<a class="headerlink" href="#react-to-a-failed-build" title="Permanent link">&para;</a></h3>
<p>One of Atomist&rsquo;s built-in automations sends a DM to the person whose commit
<a href="https://github.com/atomist/lifecycle-automation/blob/master/src/handlers/event/build/NotifyPusherOnBuild.ts">failed a build.</a></p>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<p>After unit testing your logic, your best source of information is the log of your automation client. Add <code>console.log</code> calls to your handler as needed.</p>
<h3 id="my-event-didnt-arrive">My event didn&rsquo;t arrive<a class="headerlink" href="#my-event-didnt-arrive" title="Permanent link">&para;</a></h3>
<p>First, check that your registration completed successfully in the client logs at startup.</p>
<p>Run your query in GraphiQL to verify that your event arrived to Atomist. Try adding order-by-timestamp arguments to the
top of the query, to see the most recent events that came in.</p>
<div class="codehilite"><pre><span></span>{
  Issue(orderBy: timestamp_desc, first: 10) {
    number
    timestamp
  }
}
</pre></div>

<h3 id="my-handler-didnt-do-what-i-expected">My handler didn&rsquo;t do what I expected<a class="headerlink" href="#my-handler-didnt-do-what-i-expected" title="Permanent link">&para;</a></h3>
<p>Ensure that the type of your incoming EventFired object matches the structure that you see in the query. Write unit tests that take events with the same structure and be sure to test corner cases. You can run the client locally in a debugger and trigger the events to see what is happening.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../commands/" title="Commands" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Commands
              </span>
            </div>
          </a>
        
        
          <a href="../slack/" title="Slack Messages" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Slack Messages
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2017 Atomist, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://the-composition.com/" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://github.com/atomist" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/atomist" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://join.atomist.com/" class="md-footer-social__link fa fa-slack"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-8e4952e681.js"></script>
      
      <script>app.initialize({version:"0.17.1",url:{base:"../.."}})</script>
      
        <script src="../../js/intercom.js"></script>
      
        <script src="../../js/mixpanel.js"></script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-74966852-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>