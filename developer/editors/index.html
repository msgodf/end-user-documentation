



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the Atomist Development Automation Platform">
      
      
      
        <meta name="author" content="The Atomist Team">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.1, mkdocs-material-2.0.4">
    
    
      
        <title>Editing Projects - The Atomist Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-709eec9410.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-23f75ab9c7.palette.css">
      
    
    
      <script src="../../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="blue-grey" data-md-color-accent="blue">
    
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="The Atomist Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../img/atomist-logo-horiz-reversed.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Developer Guide
                </span>
              
            
            Editing Projects
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../img/atomist-logo-horiz-reversed.svg" width="24" height="24">
      
    </span>
    The Atomist Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../user/" title="Using Atomist" class="md-nav__link">
      Using Atomist
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quick-start/" title="Developer Quick Start" class="md-nav__link">
      Developer Quick Start
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../commands/" title="Commands" class="md-nav__link">
      Commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../slack/" title="Slack Messages" class="md-nav__link">
      Slack Messages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../graphql/" title="Working with GraphQL" class="md-nav__link">
      Working with GraphQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create/" title="Creating Projects" class="md-nav__link">
      Creating Projects
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Editing Projects
      </label>
    
    <a href="./" title="Editing Projects" class="md-nav__link md-nav__link--active">
      Editing Projects
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-editor" title="Project Editor" class="md-nav__link">
    Project Editor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-an-editor" title="Running an editor" class="md-nav__link">
    Running an editor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-requests-or-commits" title="Pull requests or commits" class="md-nav__link">
    Pull requests or commits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-a-project-editor" title="Testing a project editor" class="md-nav__link">
    Testing a project editor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inmemoryproject" title="InMemoryProject" class="md-nav__link">
    InMemoryProject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-projects" title="Working with projects" class="md-nav__link">
    Working with projects
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accessing-files" title="Accessing files" class="md-nav__link">
    Accessing files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-code" title="Changing code" class="md-nav__link">
    Changing code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search-and-replace" title="Search and replace" class="md-nav__link">
    Search and replace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigating-language-asts" title="Navigating language ASTs" class="md-nav__link">
    Navigating language ASTs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-to-come" title="More to come" class="md-nav__link">
    More to come
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../client/" title="Automation Client" class="md-nav__link">
      Automation Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../run/" title="Running Automation Clients" class="md-nav__link">
      Running Automation Clients
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../support/" title="Support" class="md-nav__link">
      Support
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-editor" title="Project Editor" class="md-nav__link">
    Project Editor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-an-editor" title="Running an editor" class="md-nav__link">
    Running an editor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" title="Parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-requests-or-commits" title="Pull requests or commits" class="md-nav__link">
    Pull requests or commits
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-a-project-editor" title="Testing a project editor" class="md-nav__link">
    Testing a project editor
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inmemoryproject" title="InMemoryProject" class="md-nav__link">
    InMemoryProject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-projects" title="Working with projects" class="md-nav__link">
    Working with projects
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accessing-files" title="Accessing files" class="md-nav__link">
    Accessing files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changing-code" title="Changing code" class="md-nav__link">
    Changing code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search-and-replace" title="Search and replace" class="md-nav__link">
    Search and replace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navigating-language-asts" title="Navigating language ASTs" class="md-nav__link">
    Navigating language ASTs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-to-come" title="More to come" class="md-nav__link">
    More to come
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Editing Projects</h1>
                
                <p>Atomist is about automating more of our own work, and that includes
the work of writing code.  Not all code, of course, but the repetitive
parts of coding, or the code that you want to change across many
projects.  If the change would be so tedious to do by hand that you
wouldn&rsquo;t even bother, consider automating it.</p>
<p>Atomist provides tools that make automating writing code feasible.
Powerful file and code parsing and editing primitives can easily be
wrapped in <a href="../commands/" title="Atomist Command Automations">command automations</a>, allowing you and your team
to apply your editors to one or all of your projects to update code
and create pull requests.</p>
<h2 id="project-editor">Project Editor<a class="headerlink" href="#project-editor" title="Permanent link">&para;</a></h2>
<p>Start with a function that turns an existing Project into a promise of the Project you want it to be. We call this kind of function a <code>ProjectEditor</code>.</p>
<div class="codehilite"><pre><span></span><span class="nx">type</span> <span class="nx">SimpleProjectEditor</span><span class="o">:</span>  <span class="p">(</span><span class="nx">project</span>: <span class="kt">Project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">Project</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>

<p>The Project is an abstraction over the filesystem. This is convenient because you can use an InMemoryProject for testing.</p>
<p>This <a href="https://github.com/atomist/automation-client-samples-ts/blob/1da17e847b8e4a55ec246dfac351334ca49f3e71/src/commands/editor/addMyFile.ts">example</a> adds a file with hard-coded content:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">SimpleProjectEditor</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/operations/edit/projectEditor&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/project/Project&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">addMyFile</span>: <span class="kt">SimpleProjectEditor</span> <span class="o">=</span> <span class="p">(</span><span class="nx">project</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">ctx</span>: <span class="kt">HandlerContext</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">project</span><span class="p">.</span><span class="nx">addFile</span><span class="p">(</span><span class="s2">&quot;myFile.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;I was here&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h2 id="running-an-editor">Running an editor<a class="headerlink" href="#running-an-editor" title="Permanent link">&para;</a></h2>
<p>An editor can be transformed into a <a href="../commands/" title="Atomist Command Automations">command</a> automation; when invoked, the command will clone a repository, change the code, and push the results to GitHub as a pull request or commit.</p>
<p>This example will prompt for a repository, then create a pull request that adds the file.</p>
<div class="codehilite"><pre><span></span><span class="kr">export</span> <span class="kd">function</span> <span class="nx">addFileCommand</span><span class="p">()</span><span class="o">:</span> <span class="nx">HandleCommand</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">editorHandler</span><span class="p">(</span>
        <span class="nx">params</span> <span class="o">=&gt;</span> <span class="nx">addMyFile</span><span class="p">,</span>
        <span class="nx">BaseEditorOrReviewerParameters</span><span class="p">,</span>
        <span class="s2">&quot;AddMyFile&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">description</span><span class="o">:</span> <span class="s2">&quot;adds a tiny file&quot;</span><span class="p">,</span>
            <span class="nx">intent</span><span class="o">:</span> <span class="s2">&quot;add my file&quot;</span><span class="p">,</span>
            <span class="nx">editMode</span>: <span class="kt">new</span> <span class="nx">PullRequest</span><span class="p">(</span><span class="s2">&quot;one-tiny-file&quot;</span><span class="p">,</span> <span class="s2">&quot;Add a small file&quot;</span><span class="p">),</span>
        <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h3 id="parameters">Parameters<a class="headerlink" href="#parameters" title="Permanent link">&para;</a></h3>
<p>Editors all need to know which repository or repositories to work on. You can get additional parameters in the invocation as well, by creating your own Parameters class that extends BaseEditorOrReviewerParameters. The same ProjectEditor function works for both.</p>
<p>See the <a href="https://github.com/atomist/automation-client-samples-ts/blob/1da17e847b8e4a55ec246dfac351334ca49f3e71/src/commands/editor/addMyFile.ts">UpdateCopyright example</a> for an example of each.</p>
<h3 id="pull-requests-or-commits">Pull requests or commits<a class="headerlink" href="#pull-requests-or-commits" title="Permanent link">&para;</a></h3>
<p>The <code>editMode</code> passed in the details to <code>editorHandler</code> determines how to save the changes. Pass an instance of <a href="https://atomist.github.io/automation-client-ts/classes/_operations_edit_editmodes_.pullrequest.html">PullRequest</a>, or an implementation of <a href="https://atomist.github.io/automation-client-ts/interfaces/_operations_edit_editmodes_.branchcommit.html">BranchCommit</a>. You can also supply a function from parameters to one of these EditModes, in case you want the branch name or commit message to vary by invocation.</p>
<h2 id="testing-a-project-editor">Testing a project editor<a class="headerlink" href="#testing-a-project-editor" title="Permanent link">&para;</a></h2>
<p>ProjectEditor is a function, so it&rsquo;s testable. Unit testing at this level is quick and powerful.</p>
<h3 id="inmemoryproject">InMemoryProject<a class="headerlink" href="#inmemoryproject" title="Permanent link">&para;</a></h3>
<p>Construct a project as input to your ProjectEditor. The simplest way is to list all the files and their content:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">InMemoryProject</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/project/mem/InMemoryProject&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">startingProject</span> <span class="o">=</span> <span class="nx">InMemoryProject</span><span class="p">.</span><span class="nx">of</span><span class="p">({</span> <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;src/file1.ts&quot;</span><span class="p">,</span> <span class="s2">&quot;All the stuff in file1&quot;</span><span class="p">},</span>
                                           <span class="p">{</span> <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;test/file2.ts&quot;</span><span class="p">,</span> <span class="s2">&quot;All the stuff in file2&quot;</span><span class="p">});</span>
</pre></div>

<p>If your editor uses the <code>id</code> property on the Project, populate that too, using <code>InMemoryProject.from</code>:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">InMemoryProject</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/project/mem/InMemoryProject&quot;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">startingProject</span> <span class="o">=</span> <span class="nx">InMemoryProject</span><span class="p">.</span><span class="nx">from</span><span class="p">({</span> <span class="nx">owner</span><span class="o">:</span> <span class="s2">&quot;atomist&quot;</span><span class="p">,</span> <span class="nx">repo</span><span class="o">:</span> <span class="s2">&quot;end-user-documentation&quot;</span><span class="p">,</span> <span class="nx">sha</span><span class="o">:</span> <span class="s2">&quot;my-branch&quot;</span> <span class="p">},</span>
                                             <span class="p">{</span> <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;src/file1.ts&quot;</span><span class="p">,</span> <span class="s2">&quot;All the stuff in file1&quot;</span><span class="p">},</span>
                                             <span class="p">{</span> <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;test/file2.ts&quot;</span><span class="p">,</span> <span class="s2">&quot;All the stuff in file2&quot;</span><span class="p">});</span>
</pre></div>

<p>Here is an <a href="https://github.com/atomist/automation-client-samples-ts/blob/1da17e847b8e4a55ec246dfac351334ca49f3e71/test/commands/editor/addMyFileTest.ts">example</a> of a mocha test for the addMyFile project editor:</p>
<div class="codehilite"><pre><span></span><span class="nx">it</span><span class="p">(</span><span class="s2">&quot;adds the file&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">InMemoryProject</span><span class="p">.</span><span class="nx">of</span><span class="p">({</span> <span class="nx">path</span><span class="o">:</span> <span class="s2">&quot;existingFile.txt&quot;</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s2">&quot;Hi\n&quot;</span> <span class="p">});</span>
    <span class="nx">addMyFile</span><span class="p">(</span><span class="nx">p</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">assert</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">findFileSync</span><span class="p">(</span><span class="s2">&quot;myFile.txt&quot;</span><span class="p">)</span><span class="nx">getContentSync</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;I was here&quot;</span><span class="p">);</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">done</span><span class="p">(),</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<h2 id="working-with-projects">Working with projects<a class="headerlink" href="#working-with-projects" title="Permanent link">&para;</a></h2>
<p>The <a href="https://atomist.github.io/automation-client-ts/interfaces/_project_project_.project.html">Project</a> abstraction aims to provide both synchronous and asynchronous ways of changing projects. The synchronous methods simplify testing,
while the asynchronous ones will give better performance in your automations.</p>
<p>If you want to modify the filesystem directly in your ProjectEditor function, do what you like; find the underlying directory in <code>project.baseDir</code>.</p>
<h3 id="accessing-files">Accessing files<a class="headerlink" href="#accessing-files" title="Permanent link">&para;</a></h3>
<p>If you know the path to the file you want to change, get to it with <code>findFile</code>, and dig around in it with <code>getContents</code>:</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">HandlerContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">SimpleProjectEditor</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/operations/edit/projectEditor&quot;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Project</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;@atomist/automation-client/project/Project&quot;</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">changeMyFile</span>: <span class="kt">SimpleProjectEditor</span> <span class="o">=</span> <span class="p">(</span><span class="nx">p</span>: <span class="kt">Project</span><span class="p">,</span> <span class="nx">ctx</span>: <span class="kt">HandlerContext</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">p</span><span class="p">.</span><span class="nx">findFile</span><span class="p">(</span><span class="s2">&quot;myFile.txt&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">f</span> <span class="o">=&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">getContent</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">content</span> <span class="o">=&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span>
                    <span class="nx">arbitraryManipulation</span><span class="p">(</span><span class="nx">content</span><span class="p">))))</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">arbitraryManipulation</span><span class="p">(</span><span class="nx">oldContent</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">oldContent</span> <span class="o">+</span> <span class="s2">&quot; because I said so.\n&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>There are many more methods on Project to help manipulate one or more files.</p>
<h2 id="changing-code">Changing code<a class="headerlink" href="#changing-code" title="Permanent link">&para;</a></h2>
<p>How do we change code in code? There are the tools you&rsquo;re used to, and then the tools Atomist provides.</p>
<h3 id="search-and-replace">Search and replace<a class="headerlink" href="#search-and-replace" title="Permanent link">&para;</a></h3>
<p>Often, a simple search and replace is enough. Perhaps you want to change a version of a dependency. If you know the file you want to change, and the change you want to make to it: find the file, and then use <code>replace</code>. (It&rsquo;s the same as JavaScript&rsquo;s <code>replace</code>.)</p>
<p>The following ProjectEditor finds package.json, finds a declaration about library-of-interest, and replaces the version with <code>3.4.6</code>.</p>
<div class="codehilite"><pre><span></span><span class="kr">import</span> <span class="nx">Project</span> <span class="nx">from</span> <span class="p">...</span>
<span class="kr">import</span> <span class="nx">File</span> <span class="nx">from</span> <span class="p">...</span>

<span class="kd">function</span> <span class="nx">upgradeLibrary</span><span class="p">(</span><span class="nx">project</span>: <span class="kt">Project</span><span class="p">)</span><span class="o">:</span> <span class="nx">Promise</span><span class="o">&lt;</span><span class="nx">Project</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">project</span><span class="p">.</span><span class="nx">findFile</span><span class="p">(</span><span class="s2">&quot;package.json&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">file</span>: <span class="kt">File</span><span class="p">)</span> <span class="o">=&gt;</span>
       <span class="nx">file</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&quot;library-of-interest&quot;: &quot;.*?&quot;/</span><span class="p">,</span>
                    <span class="sb">`&quot;library-of-interest&quot;: &quot;3.4.6&quot;`</span><span class="p">);</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></div>

<div class="admonition tip"></div>
<p>Please import File from &ldquo;@atomist/automation-client/project/File&rdquo;, because TypeScript has a built-in File type that&rsquo;s different.</p>
<h3 id="navigating-language-asts">Navigating language ASTs<a class="headerlink" href="#navigating-language-asts" title="Permanent link">&para;</a></h3>
<p>You can navigate the code in your Project based on your programming language&rsquo;s abstract syntax tree (AST). We include parsers for Java, Kotlin, and TypeScript; any language with an ANTLR grammar is supported.</p>
<p>For instance, <a href="https://github.com/atomist/spring-automation/blob/8894dcb49bb1ed180beb98a57be5bf4aab908d4c/src/commands/editor/spring/removeUnnecessaryAutowiredAnnotations.ts#L20">this editor</a> discovers and manipulates constructors in Java code:</p>
<div class="codehilite"><pre><span></span><span class="kr">const</span> <span class="nx">Constructors</span> <span class="o">=</span> <span class="sb">`//classBodyDeclaration[//constructorDeclaration]`</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">removeAutowiredOnSoleConstructor</span>: <span class="kt">SimpleProjectEditor</span> <span class="o">=</span> <span class="nx">p</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">findMatches</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">JavaFileParser</span><span class="p">,</span> <span class="nx">JavaSourceFiles</span><span class="p">,</span> <span class="nx">Constructors</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">constructors</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">constructors</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">constructors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$value</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;@Autowired&quot;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">constructors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$value</span> <span class="o">=</span> <span class="nx">constructors</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/@Autowired[\s]+/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">flush</span><span class="p">();</span>
        <span class="p">});</span>
<span class="p">};</span>
</pre></div>

<h2 id="more-to-come">More to come<a class="headerlink" href="#more-to-come" title="Permanent link">&para;</a></h2>
<p>This page describes only some of the ProjectEditor functionality. There&rsquo;s additional information about project editors in <a href="https://github.com/atomist/automation-client-ts/blob/master/docs/ProjectEditors.md">@atomist/automation-client</a> and its <a href="https://atomist.github.io/automation-client-ts/index.html">TypeDoc</a>. Please come with further questions to <a href="https://join.atomist.com">Slack</a>; we&rsquo;ll be happy to answer them.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../create/" title="Creating Projects" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Creating Projects
              </span>
            </div>
          </a>
        
        
          <a href="../client/" title="Automation Client" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Automation Client
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2017 Atomist, Inc.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://the-composition.com/" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://github.com/atomist" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/atomist" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://join.atomist.com/" class="md-footer-social__link fa fa-slack"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-8e4952e681.js"></script>
      
      <script>app.initialize({version:"0.17.1",url:{base:"../.."}})</script>
      
        <script src="../../js/intercom.js"></script>
      
        <script src="../../js/mixpanel.js"></script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-74966852-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>